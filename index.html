<!DOCTYPE html>
<html lang="en">
	<head>
		<meta charset="UTF-8" />
		<meta http-equiv="X-UA-Compatible" content="IE=edge" />
		<meta name="viewport" content="width=device-width, initial-scale=1.0" />
		<title>Document</title>
	</head>
	<body>
		<div id="container">
			<input type="file" name="inputfile" id="inputfile" accept="JSON" />
			<br />
		</div>

		<script type="text/javascript">
			let outputText = "";
			outputText =
				outputText +
				"IDCLIENTE" +
				"\t" +
				"flu_numsolicitud" +
				"\t" +
				"PrimerApellido" +
				"\t" +
				"BaseSalud " +
				"\t" +
				"CodigoTipo_Aportante " +
				"\t" +
				"NumDocumentoAportante " +
				"\t" +
				"DescTipo_Cotizante " +
				"\t" +
				"CodigoTipo " +
				"\t" +
				"RazonSocialAportante " +
				"\t" +
				"PrimerApellidoSOI " +
				"\t" +
				"Novedades" +
				"\t" +
				"PeriodoCotizacion " +
				"\t" +
				"BaseCajaCompensa " +
				"\t" +
				"CodigoTipo_Cotizante " +
				"\t" +
				"CodigoTipo_Cotizante " +
				"\t" +
				"BasePension " +
				"\t" +
				"DescTipo " +
				"\t" +
				"SalarioBasico" +
				"\t" +
				"DescTipo_Aportante" +
				"\t" +
				"DescClase" +
				"\t" +
				"CodClase" +
				"\t" +
				"CC4U1029TOTALPAGADO" +
				"\t" +
				"CC4U1027DESCTIPO" +
				"\t" +
				"CC4U1029PERCOTIZSALUD" +
				"\t" +
				"CC4U1029DESCTIPOPLANTILLA" +
				"\t" +
				"CC4U1027NUMDOCUMENTO" +
				"\t" +
				"CC4U1027DESCCLASE" +
				"\t" +
				"CC4U1029CANTIDADCOTIZ" +
				"\t" +
				"CC4U1027TIPODOCUMENTO" +
				"\t" +
				"CC4U1027RAZONSOCIAL" +
				"\t" +
				"CC4U1027CODTIPO" +
				"\t" +
				"CC4U1029TIPOPLANTILLA" +
				"\t" +
				"CC4U1027DESCACTECONOMICA" +
				"\t" +
				"CC4U1027CODCLASE" +
				"\t" +
				"CC4U1029PERCOTIZOTROSUBSIS" +
				"\t" +
				"CC4U1027ACTIVECONOMICA" +
				"\n";

			document
				.getElementById("inputfile")
				.addEventListener("change", function () {
					const fr = new FileReader();
					fr.onload = function () {
						const transactionInfo = JSON.parse(fr.result);
						const aportantes = transactionInfo.aportantes;
						aportantes.forEach((aportanteInfo) => {
							const pagos = aportanteInfo.resultado_pagos;
							pagos.forEach((pagoInfo) => {
								outputText =
									outputText +
									transactionInfo.numero_identificacion_persona_natural +
									"\t"; //IDCLIENTE
								outputText = outputText + transactionInfo.consulta_id + "\t"; //flu_numsolicitud
								outputText =
									outputText +
									transactionInfo.primer_nombre_persona_natural +
									"\t"; //PrimerApellido
								outputText = outputText + transactionInfo.EPS + "\t"; //BaseSalud

								outputText =
									outputText +
									aportanteInfo.tipo_identificacion_aportante_id +
									"\t"; //CodigoTipo_Aportante
								outputText =
									outputText +
									aportanteInfo.numero_identificacion_aportante +
									"\t"; //NumDocumentoAportante
								outputText =
									outputText +
									aportanteInfo.tipo_cotizante_persona_natural +
									"\t"; //DescTipo_Cotizante
								outputText =
									outputText +
									aportanteInfo.tipo_cotizante_persona_natural +
									"\t"; //CodigoTipo
								outputText =
									outputText + aportanteInfo.razón_social_aportante + "\t"; //RazonSocialAportante
								outputText =
									outputText +
									transactionInfo.primer_nombre_persona_natural +
									"\t"; //PrimerApellidoSOI
								outputText =
									outputText +
									aportanteInfo.tiene_novedad_ingreso_actualmente +
									"\t"; //Novedades
								outputText = outputText + pagoInfo.mes_periodo_validado + "\t"; //PeriodoCotizacion
								outputText = outputText + "NULL" + "\t"; //BaseCajaCompensa
								outputText =
									outputText +
									aportanteInfo.tipo_cotizante_persona_natural +
									"\t"; //CodigoTipo_Cotizante
								outputText =
									outputText +
									aportanteInfo.tipo_cotizante_persona_natural +
									"\t"; //CodigoTipo_Cotizante

								outputText = outputText + aportanteInfo.promedio_ingresos + "\t"; //BasePension
								outputText = outputText + "NULL" + "\t"; //DescTipo
								outputText = outputText + pagoInfo.mes_periodo_validado + "\t"; //SalarioBasico
								outputText = outputText + "NULL" + "\t"; //DescTipo_Aportante
								outputText = outputText + "NULL" + "\t"; //DescClase
								outputText = outputText + "NULL" + "\t"; //CodClase
                if(pagoInfo.ingresos){
                  outputText = outputText + pagoInfo.ingresos  + "\t"; //CC4U1029TOTALPAGADO
                }else{
                  outputText = outputText + "0"  + "\t"; //CC4U1029TOTALPAGADO
                }

								
								outputText = outputText + "NULL" + "\t"; //CC4U1027DESCTIPO
								outputText = outputText + pagoInfo.mes_periodo_validado + "\t"; //CC4U1029PERCOTIZSALUD
								outputText = outputText + "NULL" + "\t"; //CC4U1029DESCTIPOPLANTILLA
								outputText =
									outputText +
									aportanteInfo.numero_identificacion_aportante +
									"\t"; //CC4U1027NUMDOCUMENTO
								outputText = outputText + "NULL" + "\t"; //CC4U1027DESCCLASE
								outputText = outputText +aportanteInfo.resultado_pagos.length + "\t"; //CC4U1029CANTIDADCOTIZ
								outputText =
									outputText +
									aportanteInfo.tipo_identificacion_aportante_id +
									"\t"; //CC4U1027TIPODOCUMENTO
								outputText =
									outputText + aportanteInfo.razón_social_aportante + "\t"; //CC4U1027RAZONSOCIAL
								outputText = outputText + "NULL" + "\t"; //CC4U1027CODTIPO
								outputText = outputText + "NULL" + "\t"; //CC4U1029TIPOPLANTILLA
								outputText = outputText + "NULL" + "\t"; //CC4U1027DESCACTECONOMICA
								outputText = outputText + "NULL" + "\t"; //CC4U1027CODCLASE
								outputText = outputText + "NULL" + "\t"; //CC4U1029PERCOTIZOTROSUBSIS
								outputText = outputText + "NULL" + "\t"; //CC4U1027ACTIVECONOMICA

								outputText = outputText + "\n";
							});
						});

						const a = document.createElement("a");
						a.href =
							"data:" +
							"text/json;charset=utf-8," +
							encodeURIComponent(outputText);
						a.download = "data.txt";
						a.innerHTML = "Descargar archivo modificado";

						var container = document.getElementById("container");
						container.appendChild(a);
					};
					fr.readAsText(this.files[0]);
				});
		</script>
	</body>
</html>
